_format_version: '2.1'
_transform: true

services:
- name: api
  url: http://api:4000
  routes:
  - name: api-route
    strip_path: true
    paths:
    - /api
  plugins:
    - name: cors
      config:
        origins:
        - http://localhost:3000
        - http://localhost:5000
        methods:
        - GET
        - POST
        - PUT
        - DELETE
        - OPTIONS
        headers:
        - Accept
        - Authorization
        - Content-Type
        - x-curity-csrf
        exposed_headers:
        - Authorization
        credentials: true
        preflight_continue: false

    - name: oauth-proxy
      config:
        cookie_prefix: th-
        cookie_key: "-----BEGIN ENCRYPTED PRIVATE KEY-----\nMIH0MF8GCSqGSIb3DQEFDTBSMDEGCSqGSIb3DQEFDDAkBBDb2gJUrdIofyca4wT5\n4utGAgIIADAMBggqhkiG9w0CCQUAMB0GCWCGSAFlAwQBKgQQ4BY0OsebJ5thRocp\n5CfKDwSBkHIWOwpTc5kJ1U4NLa4284pBXG2y1yVKB0ByARQnV52EfizVR+AvIiSv\nH1iOOYUG9WeUm3z/N8LhabFniW4/XyUqpUqkdT7HOrWwlG4ODn348rrTDqBgmjzZ\nOaoc1UIo3P7DaBwoWpEfEhu/W1TpjNf8TB+VOBDOtIUI0ZDPZR21WdnX6VBl37/P\noDvY4QGfCA==\n-----END ENCRYPTED PRIVATE KEY-----\n"
        cookie_key_pass: Password1

    - name: phantom-token
      config:
        introspection_endpoint: http://curity:8443/oauth/v2/oauth-introspect
        client_id: kong-introspection 
        client_secret: Password1
        token_cache_seconds: 900
        verify_ssl: false

- name: web-app
  url: http://web-app:3000
  routes:
  - name: web-app-route
    strip_path: false
    paths:
    - /
  plugins:
    - name: cors
      config:
        origins:
        - http://localhost:8443
        methods:
        - GET
        - POST
        - OPTIONS
        headers:
        - Accept
        - Authorization
        - Content-Type
        - x-curity-csrf
        exposed_headers:
        - Authorization
        credentials: true
        preflight_continue: false



- name: curity
  url: http://curity:8443
  routes:
  - name: curity-route
    strip_path: false
    paths:
    - /oauth/v2/oauth-userinfo
    - /apps
  plugins:
    - name: cors
      config:
        origins:
        - http://localhost:8000
        methods:
        - GET
        - POST
        - PUT
        - DELETE
        - OPTIONS
        headers:
        - Accept
        - Authorization
        - Content-Type
        - x-curity-csrf
        exposed_headers:
        - Authorization
        credentials: true
        preflight_continue: false

- name: curity-proxied
  url: http://curity:8443
  routes:
  - name: curity-proxied-route
    strip_path: false
    paths:
    - /oauth/v2/oauth-userinfo
  plugins:
    - name: cors
      config:
        origins:
        - http://localhost:8000
        methods:
        - GET
        - POST
        - PUT
        - DELETE
        - OPTIONS
        headers:
        - Accept
        - Authorization
        - Content-Type
        - x-curity-csrf
        exposed_headers:
        - Authorization
        credentials: true
        preflight_continue: false

    - name: oauth-proxy
      config:
        cookie_prefix: th-
        cookie_key: "-----BEGIN ENCRYPTED PRIVATE KEY-----\nMIH0MF8GCSqGSIb3DQEFDTBSMDEGCSqGSIb3DQEFDDAkBBDb2gJUrdIofyca4wT5\n4utGAgIIADAMBggqhkiG9w0CCQUAMB0GCWCGSAFlAwQBKgQQ4BY0OsebJ5thRocp\n5CfKDwSBkHIWOwpTc5kJ1U4NLa4284pBXG2y1yVKB0ByARQnV52EfizVR+AvIiSv\nH1iOOYUG9WeUm3z/N8LhabFniW4/XyUqpUqkdT7HOrWwlG4ODn348rrTDqBgmjzZ\nOaoc1UIo3P7DaBwoWpEfEhu/W1TpjNf8TB+VOBDOtIUI0ZDPZR21WdnX6VBl37/P\noDvY4QGfCA==\n-----END ENCRYPTED PRIVATE KEY-----\n"
        cookie_key_pass: Password1
